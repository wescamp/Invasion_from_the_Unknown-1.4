#textdomain wesnoth-Invasion_from_the_Unknown

[scenario]
    id=10_The_Source_of_Light
    name= _ "The Source of Light"
    {MAP 10_The_Source_of_Light.map}
    {TURNS 60 59 58}
    next_scenario=11_Strike_on_New_Knalga
    victory_when_enemies_defeated=no

    {SCENARIO_MUSIC "nunc_dimittis.ogg"}

    {UNDERGROUND_VOLCANO_DEFAULT}

    {STORYTXT_THE_SOURCE_OF_LIGHT}
    {STORYMAP_THE_SOURCE_OF_LIGHT}

    {DEATHS_COMMON}

    [side]
        type=Elvish Hero
        description=Galas
        user_description= _ "Galas"
        unrenamable=yes
        side=1
        canrecruit=yes
        controller=human
        team_name=good
        user_team_name= _ "team_name^Elves"
        shroud=yes
    [/side]

    # Demons
    [side]
        side=2
        description=Mena
        user_description= _ "Mena"
        type=Demon Warrior
        canrecruit=yes
        unrenamable=yes
        gender=female
        recruit=Demon,Demon Grunt,Demon Zephyr,Chaos Hound,Automaton,Blood Imp,Imp
        {GOLD 225 250 275}
        {INCOME 3 4 5}
        {CHAOS_FLAG}
        team_name=demons
        user_team_name= _ "team_name^Demons"
        [ai]
            protect_leader=6.0
            village_value=0.2
            aggression=1.0
            caution=0.0
            recruitment_ignore_bad_combat=yes
            recruitment_ignore_bad_movement=yes
        [/ai]
    [/side]

    # Undead at NE chambers
    [side]
        side=3
        income=-10
        recruit=Walking Corpse,Soulless,Vampire Bat,Ghost,Mudcrawler
        no_leader=yes
        team_name=gaia
        {HIDDEN_TEAM}
        [ai]
            aggression=0.8
            caution=0.2
            village_value=0.4
            grouping=defensive
            recruitment_ignore_bad_combat=yes
            recruitment_ignore_bad_movement=yes
        [/ai]
    [/side]

    # Fire spirits at SE chambers
    [side]
        side=4
        income=-10
        recruit=Fire Wisp,Fire Spirit
        no_leader=yes
        team_name=gaia
        {HIDDEN_TEAM}
        [ai]
            aggression=1.0
            caution=-1.0
            village_value=0.0
            grouping=defensive
        [/ai]
    [/side]

    # Ghosts at SW chambers
    [side]
        side=5
        income=-10
        recruit=Ghost,Animated Rock,Fire Wisp,Mudcrawler,Walking Corpse,Giant Leech
        no_leader=yes
        team_name=gaia
        {HIDDEN_TEAM}
        [ai]
            aggression=1.0
            caution=-1.0
            village_value=0.0
            grouping=defensive
        [/ai]
    [/side]

    # Water spirits at NW chambers
    [side]
        side=6
        income=-10
        recruit=Water Tidal,Water Spirit,Walking Corpse,Mudcrawler,Water Serpent
        no_leader=yes
        team_name=gaia
        {HIDDEN_TEAM}
        [ai]
            aggression=1.0
            caution=-1.0
            village_value=0.0
            grouping=defensive
            recruitment_ignore_bad_combat=yes
        [/ai]
    [/side]

    # Various creeps
    [side]
        side=7
        gold=0
        income=-2
        no_leader=yes
        team_name=gaia
        {HIDDEN_TEAM}
        [ai]
            aggression=1.0
            caution=-1.0
            village_value=0.0
            grouping=no
        [/ai]
    [/side]

    # Special event creeps
    [side]
        side=8
        gold=0
        income=-2
        no_leader=yes
        team_name=gaia
        {HIDDEN_TEAM}
        [ai]
            aggression=1.0
            caution=-1.0
            village_value=0.0
            grouping=no
        [/ai]
    [/side]

    # Elynia
    [side]
        side=9
        gold=0
        income=-2
        no_leader=yes
        team_name=good
        {HIDDEN_TEAM}
    [/side]

    {STARTING_VILLAGES 1 6}
    {STARTING_VILLAGES 2 6}

    [event]
        name=prestart
        {PLAYER_RECRUITMENT_SETUP_FOR_SCENARIO 10}
        # Recall heroes
        # wmllint: recognize Anlindë
        {RECALL_POS Anlindë 48 3}
        # wmllint: recognize Mal Keshar
        {RECALL_POS (Mal Keshar) 48 2}
        # wmllint: recognize Althurin
        {RECALL_POS Althurin 49 4}
        [role]
            role=boyscout
            type=Elvish Forefather,Nightgaunt,Spectre,Elvish Ancestor,Elvish Outrider,Shadow,Wraith,Elvish Rider,Ghost,Elvish Scout,Elvish Warrior Spirit
        [/role]
        [role]
            role=magic_one
            side=1
            type=Elvish Shyde,Elvish Sylph,Elvish Enchantress,Elvish Druid,Elvish Sorceress,Elvish Shaman
            [not]
                description=Anlindë
            [/not]
        [/role]
        [recall]
            x,y=50,3
            role=magic_one
        [/recall]
        [recall]
            role=boyscout
        [/recall]

        # Initialize variables
        # Glyphs's toggles - each glyph has a relative to central chamber location associated
        {VARIABLE tsl_glyph_1 off} # N
        {VARIABLE tsl_glyph_2 off} # NE
        {VARIABLE tsl_glyph_3 off} # SE
        {VARIABLE tsl_glyph_4 off} # S
        {VARIABLE tsl_glyph_5 off} # SW
        {VARIABLE tsl_glyph_6 off} # NW
        # Items
        {VARIABLE took_drainer no}
        {VARIABLE took_berserker no}
        {VARIABLE met_igor no}

        # Create some minibosses depending on difficulty
        {DIFF
        (
        {EX_LOYAL_UNIT Automaton () () 2 31 16}
        {EX_LOYAL_UNIT (Iron Golem) () () 2 30 14}
        )
        (
        {EX_LOYAL_UNIT Goliath () () 2 32 36}
        {EX_LOYAL_UNIT (Iron Golem) () () 2 30 14}
        )
        (
        {EX_LOYAL_UNIT Goliath () () 2 37 37}
        )
        }
        # Create creep guards around
        {ANONYMOUS_GUARD (Leech) 7 27 6}
#ifndef EASY
        {ANONYMOUS_GUARD (Leech) 7 33 7}
#endif
        {ANONYMOUS_GUARD (Leech) 7 21 17}
        {ANONYMOUS_GUARD (Leech) 7 22 24}
        {ANONYMOUS_GUARD (Leech) 7 41 24}
        {ANONYMOUS_GUARD (Leech) 7 29 42}
#ifndef EASY
        {ANONYMOUS_GUARD (Eyestalk) 7 39 31}
#endif
        {ANONYMOUS_GUARD (Eyestalk) 7 19 39}
        {ANONYMOUS_GUARD (Eyestalk) 7 30 38}
        {ANONYMOUS_GUARD (Eyestalk) 7 33 45}
        {ANONYMOUS_GUARD (Giant Mudcrawler) 7 25 43}
        {ANONYMOUS_GUARD (Giant Mudcrawler) 7 39 45}
        {ANONYMOUS_GUARD (Mudcrawler) 7 34 47}
        {ANONYMOUS_WC_GUARD saurian 7 15 31}
#ifndef EASY
        {ANONYMOUS_GUARD (Lesser Giant Spider) 7 3 8}
#endif
        {ANONYMOUS_GUARD (Giant Leech) 7 3 16}
#ifdef HARD
        {ANONYMOUS_GUARD (Lesser Giant Spider) 7 5 18}
#endif
        {ANONYMOUS_GUARD (Giant Mudcrawler) 7 10 8}
#ifdef EASY
        {ANONYMOUS_GUARD (Mudcrawler) 7 7 5}
#else
        {ANONYMOUS_GUARD (Giant Mudcrawler) 7 7 5}
#endif
        {ANONYMOUS_WC_GUARD drake 7 17 3}
        {ANONYMOUS_WC_GUARD drake 7 19 8}
#ifdef NORMAL
        {ANONYMOUS_GUARD (Giant Leech) 7 20 10}
#else
#ifdef HARD
        {ANONYMOUS_GUARD (Brain Drainer) 7 20 10}
#endif
#endif
        {ANONYMOUS_GUARD (Giant Leech) 7 9 4}
        {ANONYMOUS_GUARD (Giant Leech) 7 5 11}
        {ANONYMOUS_GUARD (Giant Ant) 7 16 8}
#ifndef EASY
        {ANONYMOUS_GUARD (Giant Ant) 7 16 11}
#endif
        {ANONYMOUS_GUARD (Giant Ant) 7 26 6}
        {ANONYMOUS_GUARD (Giant Ant) 7 33 3}
        {ANONYMOUS_GUARD (Giant Scorpion) 7 36 4}
#ifndef EASY
        {ANONYMOUS_GUARD (Lesser Giant Spider) 7 31 5}
        {ANONYMOUS_GUARD (Lesser Giant Spider) 7 36 11}
        {ANONYMOUS_GUARD (Lesser Giant Spider) 7 38 12}
#endif
        {ANONYMOUS_GUARD (Giant Ant) 7 8 35}
        {ANONYMOUS_GUARD (Giant Ant) 7 23 37}
        {ANONYMOUS_GUARD (Giant Ant) 7 48 8}
        {ANONYMOUS_GUARD (Giant Ant) 7 47 9}
        {ANONYMOUS_GUARD (Giant Ant) 7 47 8}
        {ANONYMOUS_GUARD (Eyestalk) 7 39 8}
        {ANONYMOUS_GUARD (Giant Ant) 7 24 21}
        {ANONYMOUS_GUARD (Giant Ant) 7 24 22}
        {ANONYMOUS_GUARD (Blood Bat) 7 23 32}
        {ANONYMOUS_WC_GUARD dwarf 7 25 30}
        {ANONYMOUS_SOULLESS_GUARD dwarf 7 38 27}
        {ANONYMOUS_WC_GUARD wose 7 35 9}
        {ANONYMOUS_WC_GUARD bat 7 30 34}
        {ANONYMOUS_WC_GUARD bat 7 33 33}
        {ANONYMOUS_WC_GUARD bat 7 27 32}
        {ANONYMOUS_SOULLESS_GUARD wose 7 28 40}
        {ANONYMOUS_GUARD (Fungoid) 7 20 41}
        {ANONYMOUS_GUARD (Fungoid) 7 34 20}
        {ANONYMOUS_GUARD (Fungoid) 7 25 36}
        {ANONYMOUS_GUARD (Fungoid) 7 23 30}
        {ANONYMOUS_GUARD (Fungoid) 7 35 42}
        {ANONYMOUS_GUARD (Giant Mudcrawler) 7 3 2}
#ifndef EASY
        {ANONYMOUS_GUARD (Dread Bat) 7 23 13}
        {ANONYMOUS_GUARD (Blood Bat) 7 10 6}
        {ANONYMOUS_GUARD (Vampire Bat) 7 9 11}
#endif
        {ANONYMOUS_GUARD {DIFF (Vampire Bat) (Blood Bat) (Blood Bat)} 7 39 20}
        {ANONYMOUS_GUARD (Giant Scorpion) 7 45 41}
        {ANONYMOUS_GUARD (Giant Ant) 7 22 20}
        {ANONYMOUS_WC_GUARD drake 7 29 44}

        [objectives]
            side=1
            {OBJECTIVE_TO_WIN ( _ "Find the 'Source of Light'. She must be sleeping somewhere in these caves.")}
            {OBJECTIVE_TO_LOSE ( _ "Death of Galas")}
            {OBJECTIVE_TO_LOSE ( _ "Death of Anlindë")}
            {OBJECTIVE_TO_LOSE ( _ "Death of Mal Keshar")}
            {OBJECTIVE_TO_LOSE ( _ "Death of Althurin")}
            {OBJECTIVE_TO_LOSE ( _ "Turns run out")}
        [/objectives]
    [/event]

    [event]
        name=start
        [message]
            x,y=50,3
            message= _ "It is... an enormous power fills the entire place!"
        [/message]
        {MSG_UNIT (Mal Keshar) ( _ "I feel it. It is the Source of Light. Her presence is weak in comparison to when she was in the surface, but strong anyway.")}
        {MSG_UNIT Anlindë ( _ "It is here. We have arrived, finally...")}
        {MSG_UNIT Galas ( _ "You magic-skilled people can perceive things I cannot.")}
        {MSG_UNIT Althurin ( _ "Indeed, lad. Magic experience grants you the ability to perceive things which existance normal people ignore. My runic detectors indicate that an ancient magic affects these tunnels, a magic which is unknown to us people of present time.")}
        {MSG_UNIT Galas ( _ "Fair enough, find the Source. We should not waste too much time in this search, for we do not know when the enemy will fall upon Knalga.")}
        {MSG_UNIT (Mal Keshar) ( _ "If it has not already.")}
        {MSG_UNIT Althurin ( _ "I hope that is has not. Our thriving economy would not support us in a full-sized war yet.")}
        {TREMOR}
        [message]
            role=boyscout
            message= _ "Less chatter and more scouting, people, before the earth falls over us!"
        [/message]
    [/event]

    [event]
        name=attack
        [filter]
            type=Goliath
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        {MSG_SPEAKER second_unit ( _ "Surely I could use some help here!")}
        {MSG_SPEAKER unit ( _ "Die, microscopic vermin!")}
    [/event]

    [event]
        name=sighted
        [filter]
            side=2
        [/filter]
        [if]
            [have_unit]
                description=Mena
            [/have_unit]
            [then]
                {MSG_SPEAKER unit ( _ "The elves! Damn, the back guards could not against them!")}
                {MSG_UNIT Mena ( _ "Persistent fools. Never mind, we shall destroy them, shan't we? For the Dark Lord!")}
                {MSG_SPEAKER second_unit ( _ "Oh.")}
                {MSG_UNIT Galas ( _ "They must be after our lady, they want to stop us!")}
                {MSG_UNIT (Mal Keshar) ( _ "Their master must be certain of what fate awaits him or her if we call upon the power of the Union. And looks like they have a never-ending supply of grunt attack force.")}
                {MSG_UNIT Galas ( _ "We must try and defeat them here, once for all, and secure the place.")}

                [objectives]
                    side=1
                    {OBJECTIVE_TO_WIN ( _ "Defeat the demon leader")}
                    {OBJECTIVE_TO_LOSE ( _ "Death of Galas")}
                    {OBJECTIVE_TO_LOSE ( _ "Death of Anlindë")}
                    {OBJECTIVE_TO_LOSE ( _ "Death of Mal Keshar")}
                    {OBJECTIVE_TO_LOSE ( _ "Death of Althurin")}
                    {OBJECTIVE_TO_LOSE ( _ "Turns run out")}
                [/objectives]
            [/then]
        [/if]
    [/event]

    [event]
        name=die
        [filter]
            description=Mena
        [/filter]

        {MSG_SPEAKER unit ( _ "Master... I have... failed... *falls lifeless to the ground*")}
        {MSG_SPEAKER second_unit ( _ "Die, you fiend, and stay dead!")}

        {TREMOR}

        # Open path to central chamber
        [terrain]
            terrain=Uh
            x,y=29-30,18
        [/terrain]
        [terrain]
            terrain=Uh
            x,y=34-35,18
        [/terrain]
        [terrain]
            terrain=Uu^Uf
            x=32,33
            y=18,19
        [/terrain]
        [terrain]
            x=31
            y=18
            terrain=Rp
        [/terrain]
        [terrain]
            x=36-39
            y=18
            terrain=Qxu # wmllint: ignore
        [/terrain]

        {MSG_SPEAKER second_unit ( _ "Oooh! What the... hey, look! The cave wall there has raised!")}
        [remove_shroud]
            {RECT 28 16 36 20}
        [/remove_shroud]
        {REDRAW}
        [scroll_to]
            x,y=31,19
        [/scroll_to]
        {DELAY 400}
        {MSG_UNIT (Galas) ( _ "There we go!")}
        {SCROLL_TO $x1 $y1}

        [objectives]
            side=1
            {OBJECTIVE_TO_WIN ( _ "Explore the main chamber and find the 'Source of Light'")}
            {OBJECTIVE_TO_LOSE ( _ "Death of Galas")}
            {OBJECTIVE_TO_LOSE ( _ "Death of Anlindë")}
            {OBJECTIVE_TO_LOSE ( _ "Death of Mal Keshar")}
            {OBJECTIVE_TO_LOSE ( _ "Death of Althurin")}
            {OBJECTIVE_TO_LOSE ( _ "Turns run out")}
        [/objectives]

        [event]
            name=moveto
            [filter]
                side=1
                {RECT 22 19 41 34}
            [/filter]

            {TREMOR}
            {TREMOR}

            [terrain]
                terrain=Ryd # wmllint: ignore
                x=24,25-26
                y=7 ,8
            [/terrain]

            # Awake chamber guards (sides 3, 4, 5, 6), giving them leaders who can recruit, gold, and loyal guards
            [modify_side]
                side=3
                {GOLD 50 75 100}
            [/modify_side]
            [unit]
#ifndef EASY
                type=Soulless
#else
                type=Walking Corpse
#endif
                variation=wose
                canrecruit=yes
                side=3
                unrenamable=yes
                x,y=49,21
            [/unit]
            {ANONYMOUS_SOULLESS_GUARD troll 3 45 20}
#ifndef EASY
            {ANONYMOUS_SOULLESS_GUARD troll 3 53 21}
#endif
#ifdef HARD
            {ANONYMOUS_SOULLESS_GUARD troll 3 47 12}
#endif
            {ANONYMOUS_WC_GUARD wose 3 45 14}
#ifndef EASY
            {ANONYMOUS_WC_GUARD drake 3 49 14}
            {ANONYMOUS_WC_GUARD saurian 3 46 16}
#endif
            {ANONYMOUS_GUARD (Brain Drainer) 3 56 24}
#ifdef HARD
            {ANONYMOUS_GUARD (Giant Leech) 3 53 31}
#endif
            {ANONYMOUS_WC_GUARD drake 3 53 25}
            {ANONYMOUS_GUARD {DIFF (Blood Bat) (Blood Bat) (Dread Bat)} 3 49 25}
#ifdef HARD
            {ANONYMOUS_GUARD (Blood Bat) 3 54 26}
#endif
            {ANONYMOUS_GUARD (Vampire Bat) 3 43 12}
            {ANONYMOUS_GUARD (Blood Bat) 3 51 13}
            {ANONYMOUS_WC_GUARD wose 3 45 15}
            {ANONYMOUS_WC_GUARD dwarf 3 42 18}
            {ANONYMOUS_WC_GUARD dwarf 3 45 21}
#ifndef EASY
            {ANONYMOUS_GUARD Skeleton 3 51 18}
#endif
            {ANONYMOUS_GUARD Skeleton 3 50 28}
#ifdef HARD
            {ANONYMOUS_GUARD (Skeleton Archer) 3 48 28}
#endif
            {ANONYMOUS_GUARD Ghoul_C 3 49 31}
            {ANONYMOUS_GUARD (Walking Corpse) 3 50 31}
            {ANONYMOUS_GUARD Ghoul_C 3 45 28}
#ifdef HARD
            {ANONYMOUS_GUARD Ghoul_C 3 49 27}
#endif
            {CAPTURE_VILLAGE 3 (45-52) (17-24)}

            [modify_side]
                side=4
                {GOLD 50 75 100}
            [/modify_side]
            [unit]
                type=Fire Spirit
                canrecruit=yes
                side=4
                unrenamable=yes
                x,y=55,47
            [/unit]
            {ANONYMOUS_WC_GUARD drake 4 54 41}
#ifndef EASY
            {ANONYMOUS_WC_GUARD drake 4 50 44}
#endif
            {ANONYMOUS_WC_GUARD drake 4 50 42}
#ifdef HARD
            {ANONYMOUS_WC_GUARD drake 4 43 43}
            {ANONYMOUS_GUARD (Fire Wisp) 4 47 39}
#endif
            {ANONYMOUS_GUARD (Fire Wisp) 4 41 50}
#ifndef EASY
            {ANONYMOUS_GUARD (Fire Wisp) 4 55 45}
#endif
            {ANONYMOUS_GUARD {DIFF (Fire Wisp) (Fire Spirit) (Fire Spirit)} 4 44 47}
            {ANONYMOUS_GUARD (Fire Wisp) 4 39 45}
            {ANONYMOUS_GUARD {DIFF (Fire Wisp) (Fire Spirit) (Fire Spirit)} 4 44 49}
            {ANONYMOUS_GUARD {DIFF (Fire Wisp) (Fire Spirit) (Fire Spirit)} 4 38 36}
#ifdef HARD
            {ANONYMOUS_GUARD (Fire Wisp) 4 44 38}
#endif
            {ANONYMOUS_GUARD (Fire Wisp) 4 41 41}
#ifndef EASY
            {ANONYMOUS_GUARD (Fire Wisp) 4 47 35}
#endif
            {ANONYMOUS_WC_GUARD drake 4 50 36}
            {ANONYMOUS_WC_GUARD troll 4 54 39}
#ifdef HARD
            {ANONYMOUS_WC_GUARD wose 4 49 40}
            {ANONYMOUS_WC_GUARD drake 4 43 41}
            {ANONYMOUS_WC_GUARD troll 4 45 40}
#endif
            {ANONYMOUS_WC_GUARD mounted 4 48 48}
#ifdef HARD
            {ANONYMOUS_WC_GUARD saurian 4 51 50}
#endif
            {ANONYMOUS_WC_GUARD saurian 4 53 48}
#ifndef EASY
            {ANONYMOUS_WC_GUARD drake 4 41 47}
#endif
#ifdef NORMAL
            {ANONYMOUS_WC_GUARD wose 4 42 32}
            {ANONYMOUS_WC_GUARD drake 4 41 35}
#else
#ifdef HARD
            {ANONYMOUS_SOULLESS_GUARD wose 4 42 32}
            {ANONYMOUS_SOULLESS_GUARD drake 4 41 35}
#endif
#endif
            {CAPTURE_VILLAGE 4 (42-54) (35-46)}

            [modify_side]
                side=5
                {GOLD 50 75 100}
            [/modify_side]
            # Golem leader
            [unit]
                type=Rock Golem
                canrecruit=yes
                side=5
                unrenamable=yes
                x,y=11,47
            [/unit]
            [unit]
                type=Rock Golem
                description=Glyph Guard Golem
                side=5
                unrenamable=yes
                x,y=10,46
            [/unit]
            # This special golem cannot move around, but has great defense ratios
            [object]
                silent=yes
                [filter]
                    description=Glyph Guard Golem
                [/filter]
                [effect]
                    apply_to=movement
                    set=1
                [/effect]
                [effect]
                    apply_to=movement_costs
                    replace=true
                    [movement_costs]
                        deep_water=99
                        shallow_water=99
                        swamp_water=99
                        grassland=99
                        sand=99
                        forest=99
                        hills=99
                        mountains=99
                        village=99
                        castle=99
                        cave=99
                        tundra=99
                        canyon=99
                        cavewall=99
                        fungus=99
                    [/movement_costs]
                [/effect]
                [effect]
                    apply_to=defense
                    replace=true
                    [defense]
                        cave=30
                        cavewall=20
                        hills=30
                        mountains=20
                        fungus=30
                    [/defense]
                [/effect]
            [/object]

            {ANONYMOUS_GUARD (Animated Rock) 5 6 44}
#ifndef EASY
            {ANONYMOUS_GUARD (Animated Rock) 5 11 43}
#endif
            {ANONYMOUS_GUARD (Animated Rock) 5 7 48}
#ifdef HARD
            {ANONYMOUS_GUARD (Rock Golem) 5 6 40}
#endif
            {ANONYMOUS_GUARD (Animated Rock) 5 2 39}
            {ANONYMOUS_GUARD (Animated Rock) 5 6 37}
            {ANONYMOUS_GUARD (Animated Rock) 5 10 32}
#ifndef EASY
            {ANONYMOUS_GUARD (Dread Bat) 5 8 39}
#endif
#ifdef HARD
            {ANONYMOUS_GUARD (Dread Bat) 5 1 36}
            {ANONYMOUS_GUARD (Ghoul_C) 5 9 44}
#endif
            {ANONYMOUS_GUARD (Giant Mudcrawler) 5 7 45}
            {ANONYMOUS_SOULLESS_GUARD saurian 5 9 48}
            {ANONYMOUS_WC_GUARD wose 5 3 39}
            {ANONYMOUS_WC_GUARD wose 5 8 46}
            {ANONYMOUS_WC_GUARD dwarf 5 12 45}
#ifndef EASY
            {ANONYMOUS_GUARD (Ghost) 5 5 35}
#endif
#ifdef HARD
            {ANONYMOUS_GUARD (Ghost) 5 3 43}
#endif
            {CAPTURE_VILLAGE 5 (4-16) (42-50)}

            [modify_side]
                side=6
                {GOLD 50 75 90}
            [/modify_side]
            [unit]
#ifndef HARD
                type=Water Serpent
#else
                type=Cuttle Fish
#endif
                canrecruit=yes
                side=6
                unrenamable=yes
                x,y=7,27
            [/unit]
            {ANONYMOUS_WC_GUARD swimmer 6 1 25}
            {ANONYMOUS_WC_GUARD saurian 6 2 28}
#ifdef HARD
            {ANONYMOUS_SOULLESS_GUARD swimmer 6 6 29}
            {ANONYMOUS_WC_GUARD swimmer 6 11 26}
#endif
            {ANONYMOUS_WC_GUARD swimmer 6 14 23}
            {ANONYMOUS_WC_GUARD saurian 6 15 29}
#ifndef EASY
            {ANONYMOUS_WC_GUARD swimmer 6 12 28}
            {ANONYMOUS_WC_GUARD swimmer 6 15 19}
#endif
            {ANONYMOUS_WC_GUARD saurian 6 20 16}
            {ANONYMOUS_WC_GUARD saurian 6 11 27}
            {ANONYMOUS_GUARD (Tentacle of the Deep) 6 9 27}
            {ANONYMOUS_GUARD (Tentacle of the Deep) 6 20 28}
            {ANONYMOUS_GUARD (Tentacle of the Deep) 6 12 26}

            {ANONYMOUS_GUARD (Tentacle of the Deep) 6 15 28}
            {ANONYMOUS_GUARD (Water Spirit) 6 4 26}
            {ANONYMOUS_GUARD (Water Tidal) 6 4 30}
            {ANONYMOUS_GUARD (Water Tidal) 6 20 25}
            {ANONYMOUS_SOULLESS_GUARD swimmer 6 1 27}
            {ANONYMOUS_SOULLESS_GUARD wose 6 3 27}
            {CAPTURE_VILLAGE 6 (4-13) (24-30)}

            # Change music to a more calm, yet sinister theme
            [music]
                name=snowfall.ogg
                immediate=yes
            [/music]

            # Unshroud central chamber
            [remove_shroud]
                x=24-38
                y=19-31
            [/remove_shroud]

            {MSG_UNIT Galas ( _ "The earth shakes! It must be a volcanic eruption!")}
            {MSG_UNIT (Mal Keshar) ( _ "No, it is not. We are just awakening the forces of nature with our mere presence here. It indicates nobody has stepped in these caves for a long time, possibly for millions of years.")}
            {MSG_UNIT Anlindë ( _ "Except the Lady of Light, whose presence comes from the walls at the center of the chamber!")}
            {MSG_UNIT Galas ( _ "What should we do? These walls are impassable!")}
            {MSG_UNIT (Mal Keshar) ( _ "I think there must be a way to open the walls. The chamber is shaped around a hexagonal centre, and its corners look strangely clean. The runes carved in each one of them must indicate something, and being all different in each corner, it might mean that we have got to activate them from six different places, distant from the chamber.")}
            {MSG_UNIT Althurin ( _ "Yes, runic glyphs! They activate on contact, and most important chambers, gates and tunnels are designed to be opened via this sort of glyphs. But, where are them?")}
            {MSG_UNIT Galas ( _ "We'll have to explore to find out their locations.")}
            {MSG_UNIT (Mal Keshar) ( _ "We ought to be careful. We are not welcome here.")}
            [objectives]
                side=1
                {OBJECTIVE_TO_WIN ( _ "Find the 6 glyphs that should open the central chamber")}
                {OBJECTIVE_TO_LOSE ( _ "Death of Galas")}
                {OBJECTIVE_TO_LOSE ( _ "Death of Anlindë")}
                {OBJECTIVE_TO_LOSE ( _ "Death of Mal Keshar")}
                {OBJECTIVE_TO_LOSE ( _ "Death of Althurin")}
                {OBJECTIVE_TO_LOSE ( _ "Turns run out")}
            [/objectives]
            {VARIABLE tcx 0}
            [event]
                name=new turn
                first_time_only=no
                [if]
                    {VARIABLE_NUM_LESS_THAN tcx 3}
                    [then]
                        {VARIABLE_INC tcx}
                    [/then]
                [/if]
            [/event]
            [event]
                name=new turn
                first_time_only=no
                [if]
                    {VARIABLE_NUM_EQUALS tcx 2}
                    [then]
                        {MSG_UNIT (Mal Keshar) ( _ "Perhaps if I concentrate for a while, I could figure out the location of each glyph.")}
                        {MSG_UNIT Galas ( _ "Oh yes? That would be a great help.")}
                        [objectives]
                            side=1
                            {OBJECTIVE_TO_WIN ( _ "Find the 6 glyphs that should open the central chamber")}
                            {OBJECTIVE_TO_LOSE ( _ "Death of Galas")}
                            {OBJECTIVE_TO_LOSE ( _ "Death of Anlindë")}
                            {OBJECTIVE_TO_LOSE ( _ "Death of Mal Keshar")}
                            {OBJECTIVE_TO_LOSE ( _ "Death of Althurin")}
                            {OBJECTIVE_TO_LOSE ( _ "Turns run out")}
                            {OBJECTIVE_NOTES ( _ "Let Mal Keshar rest for three turns and he'll reveal the location of each magic glyph.")}
                        [/objectives]
                        {VARIABLE located_glyphs no}
                        {VARIABLE resting_tcx 0}
                        [event]
                            name=new turn
                            first_time_only=no
                            [if]
                                {VARIABLE_BOOLEAN_EQUALS located_glyphs no}
                                [then]
                                    [store_unit]
                                        [filter]
                                            description=Mal Keshar
                                        [/filter]
                                        kill=no
                                        variable=mal_keshar_probe
                                    [/store_unit]
                                    [if]
                                        {VARIABLE_BOOLEAN_EQUALS mal_keshar_probe.resting yes}
                                        [then]
                                            {VARIABLE_INC resting_tcx}
                                        [/then]
                                        [else]
                                            # Reset and wait for new unit rest cycle
                                            {VARIABLE resting_tcx 0}
                                        [/else]
                                    [/if]
                                    {CLEAR_VARIABLE mal_keshar_probe}
                                [/then]
                            [/if]
                        [/event]
                        [event]
                            name=new turn
                            first_time_only=no
                            [if]
                                {VARIABLE_BOOLEAN_EQUALS located_glyphs no}
                                {VARIABLE_NUM_GREATER_OR_EQUAL_THAN resting_tcx 3}
                                [then]
                                    {VARIABLE located_glyphs yes}
                                    # Central chamber goal glyphs
                                    # North
                                    [remove_shroud]
                                        {RECT 15 1 22 4}
                                    [/remove_shroud]
                                    # North-east
                                    [remove_shroud]
                                        {RECT 45 12 49 15}
                                    [/remove_shroud]
                                    # South-east
                                    [remove_shroud]
                                        {RECT 49 47 54 50}
                                    [/remove_shroud]
                                    # South
                                    [remove_shroud]
                                        {RECT 22 38 27 43}
                                    [/remove_shroud]
                                    # South-west
                                    [remove_shroud]
                                        {RECT 8 44 12 48}
                                    [/remove_shroud]
                                    # North-west
                                    [remove_shroud]
                                        {RECT 0 24 5 29}
                                    [/remove_shroud]
                                    {MSG_UNIT (Mal Keshar) ( _ "Ah, got it.")}
                                    {REDRAW}
                                    {SCROLL_TO 19 2}
                                    {DELAY 500}
                                    {SCROLL_TO 47 13}
                                    {DELAY 500}
                                    {SCROLL_TO 52 48}
                                    {DELAY 500}
                                    {SCROLL_TO 24 40}
                                    {DELAY 500}
                                    {SCROLL_TO 10 46}
                                    {DELAY 500}
                                    {SCROLL_TO 2 26}
                                    {DELAY 500}
                                    {MSG_UNIT Anlindë ( _ "Ah, thanks. This will ease our search greatly. Now we just have to find a way to get to each location.")}
                                    [objectives]
                                        side=1
                                        {OBJECTIVE_TO_WIN ( _ "Activate the 6 glyphs that should open the central chamber")}
                                        {OBJECTIVE_TO_LOSE ( _ "Death of Galas")}
                                        {OBJECTIVE_TO_LOSE ( _ "Death of Anlindë")}
                                        {OBJECTIVE_TO_LOSE ( _ "Death of Mal Keshar")}
                                        {OBJECTIVE_TO_LOSE ( _ "Death of Althurin")}
                                        {OBJECTIVE_TO_LOSE ( _ "Turns run out")}
                                    [/objectives]
                                [/then]
                            [/if]
                        [/event]
                    [/then]
                [/if]
            [/event]
            [event]
                name=victory
                {CLEAR_VARIABLE resting_tcx}
                {CLEAR_VARIABLE tcx}
                {CLEAR_VARIABLE located_glyphs}
            [/event]
        [/event]
    [/event]

    # Macro to simplify the process of defining each glyph's base events
#define TSL_GLYPH_EVENT X Y GLYPHNUM
    [item]
        x,y={X},{Y}
        image=scenery/rune{GLYPHNUM}.png
    [/item]
    [event]
        name=moveto
        [filter]
            side=1
            x,y={X},{Y}
        [/filter]
        {VARIABLE (tsl_glyph_{GLYPHNUM}) ("on")}
        [removeitem]
            x,y={X},{Y}
        [/removeitem]
        [item]
            x,y={X},{Y}
            image=scenery/rune{GLYPHNUM}-glow.png
        [/item]
        {REDRAW}
        {MSG_NARRATOR ( _ "Glyph activated.")}
    [/event]
#enddef

    # Central chamber goal glyphs
    # North
    {TSL_GLYPH_EVENT 19 2  1}
    # North-east
    {TSL_GLYPH_EVENT 47 13 2}
    # South-east
    {TSL_GLYPH_EVENT 52 48 3}
    # South
    {TSL_GLYPH_EVENT 24 40 4}
    # South-west
    {TSL_GLYPH_EVENT 10 46 5}
    # North-west
    {TSL_GLYPH_EVENT  2 26 6}

    #undef TSL_GLYPH_EVENT

    # And their secondary events - not all of them have one
    [event]
        name=moveto
        [filter]
            side=1
            x,y=47,13
        [/filter]

        [terrain]
            x,y=47,10-11
            terrain=Uu
        [/terrain]
        [terrain]
            x=43   ,50,51
            y=10-11,9 ,10
            terrain=Qxu # wmllint: ignore
        [/terrain]

        {MSG_NARRATOR ( _ "A wall moves.")}
    [/event]

    # Elynia awakening event - relies on user performing a movement
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
        [/filter]
        [allow_undo]
        [/allow_undo]
        [if]
            [variable]
                name=tsl_glyph_1
                equals="on"
            [/variable]
            [and]
                [variable]
                    name=tsl_glyph_2
                    equals="on"
                [/variable]
            [/and]
            [and]
                [variable]
                    name=tsl_glyph_3
                    equals="on"
                [/variable]
            [/and]
            [and]
                [variable]
                    name=tsl_glyph_4
                    equals="on"
                [/variable]
            [/and]
            [and]
                [variable]
                    name=tsl_glyph_5
                    equals="on"
                [/variable]
            [/and]
            [and]
                [variable]
                    name=tsl_glyph_6
                    equals="on"
                [/variable]
            [/and]
            [then]
                {ENDLEVEL_VICTORY yes}
            [/then]
        [/if]
    [/event]

    [event]
        name=victory
        [sound]
            name=lightning.ogg
        [/sound]
        {FLASH_BLUE () }
        {TREMOR}
        {DELAY 400}
        {TREMOR}
        {TREMOR}
        {MSG_NARRATOR ( _ "All glyphs activated. The earth shakes!")}
        {TREMOR}
        [sound]
            name=lightning.ogg
        [/sound]
        {FLASH_BLUE () }
        [sound]
            name=lightning.ogg
        [/sound]
        {FLASH_BLUE () }
        [terrain_mask]
            x,y=25,21
            {MASK 10_The_Source_of_Light.mask}
            [rule]
                new=_s # wmllint: ignore
                use_old=yes
            [/rule]
        [/terrain_mask]
        {REDRAW}
        # Elynia's bodyguards
        {ANONYMOUS_GUARD (Wose) 9 29 26}
        [+unit]
            {FACING_REVERSE}
        [/unit]
        {ANONYMOUS_GUARD (Wose) 9 33 26}
        {ANONYMOUS_GUARD (Wose) 9 30 24}
        [+unit]
            {FACING_REVERSE}
        [/unit]
        {ANONYMOUS_GUARD (Wose) 9 32 24}
        {ANONYMOUS_GUARD (Wose) 9 30 27}
        [+unit]
            {FACING_REVERSE}
        [/unit]
        {ANONYMOUS_GUARD (Wose) 9 32 27}

        # Unshroud central chamber
        [remove_shroud]
            {RECT 22 20 39 32}
        [/remove_shroud]

        [scroll_to]
            x,y=31,26
        [/scroll_to]

        {DELAY 750}

        {MSG_UNIT Galas ( _ "This is it!")}
        {MSG_UNIT (Mal Keshar) ( _ "She is there, let us go.")}
        {MSG_UNIT Anlindë ( _ "I have been waiting this for too long.")}

        [teleport]
            [filter]
                description=Althurin
            [/filter]
            x,y=27,27
        [/teleport]
        [teleport]
            [filter]
                description=Galas
            [/filter]
            x,y=27,26
        [/teleport]
        [teleport]
            [filter]
                description=Mal Keshar
            [/filter]
            x,y=27,25
        [/teleport]
        [teleport]
            [filter]
                description=Anlindë
            [/filter]
            x,y=28,26
        [/teleport]
        [unit]
            type=Skeleton Archer
            upkeep=full
            x,y=28,25
            side=1
        [/unit]
        {SET_FACING (
        x=27-28
        y=25-27
        ) (se)}

        [scroll_to]
            x,y=31,26
        [/scroll_to]
        {DELAY 500}

        [message]
            x,y=28,25
            message= _ "Hello there! Anybody at home?"
        [/message]
        [message]
            type=Wose
            message= _ "Intruders! Protect the Lady of Light!"
        [/message]

        [sound]
            name=magic-holy-4.ogg
        [/sound]
        [sound]
            name=lightning.ogg
        [/sound]
        {FLASH_WHITE () }
        [message]
            x,y=28,25
            message= _ "Argh!! Yelp..."
        [/message]
        [kill]
            x,y=28,25
            animate=yes
        [/kill]

        [message]
            type=Wose
            message= _ "Destroy the necromancer!!"
        [/message]
        {MSG_UNIT (Mal Keshar) ( _ "Huh? Prepare to meet your fate, you...")}
        {MSG_UNIT Anlindë ( _ "Stop, we are the Elves of the Valley of Elynia, you must let us pass!")}
        [message]
            type=Wose
            message= _ "Elves? Impossible, you must be dead by now! Prove that you are true elves!"
        [/message]
        {MSG_UNIT Anlindë ( _ "I call upon the light of Eloh! May it awake our sage from her millenary sleep!")}
        [sound]
            name=magic-holy-2.ogg
        [/sound]
        [sound]
            name=lightning.ogg
        [/sound]
        {FLASH_WHITE () }
        # Open to suggestions. I'm not very romantic, ain't I? Huh? What the hell.
        {MSG_NARRATOR ( _ "As Anlindë pronounced the spell, the great tree at the center of the chamber disappeared, and a beautiful elven lady materialized in its place, laying in the grass floor. Big dragonfly wings on her back, her pale red hair and eyes, made it obvious that she was not any elf, but the Lady of Light. Half-asleep, her powers were still enough to illuminate the surroundings without requiring any minimal effort from her.")}
        [terrain]
            x,y=31,26
            terrain=Ggf # wmllint: ignore
        [/terrain]
        {REDRAW}
        [unit]
            side=9
            canrecruit=yes
            type=Lady of Light
            gender=female
            description=Elynia
            user_description= _ "Elynia"
            x,y=31,26
            {FACING_REVERSE}
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_DEXTROUS}
            [/modifications]
        [/unit]
        {REDRAW}
        [scroll_to]
            x,y=31,26
        [/scroll_to]
        {DELAY 1000}
        {MSG_UNIT Elynia ( _ "(sleepy) Who has... awaken me?")}
        {DUMMY _"Note for translators: Galas is supposed to be saying 'we', so the 'W' here stands for the first syllabe or half of it, depending on the target translation language."}
        [message]
            description=Galas
            message= _ "W..."
        [/message]
        {MSG_UNIT Elynia ( _ "Elves? But how... how did you find this place... I must be still asleep.")}
        {DUMMY _"Note for translators: Mal Keshar is supposed to be saying 'actually', so whatever thing you put here in the target language, must be phonetically ~3 syllabes long. Only a suggestion anyway."}
        [message]
            description=Mal Keshar
            message= _ "Actual..."
        [/message]
        {MSG_UNIT Elynia ( _ "Necromancer, prepare to die... again!!!")}
        {MSG_UNIT Anlindë ( _ "No, wait a second...")}

        # Let's have some fun :-)
        [store_unit]
            [filter]
                description=Mal Keshar
            [/filter]
            kill=no
            variable=malin_store
        [/store_unit]

        [sound]
            name=magic-holy-1.ogg
        [/sound]
        [sound]
            name=lightning.ogg
        [/sound]
        {FLASH_WHITE () }

        [kill]
            fire_event=no
            animate=yes
            description=Mal Keshar
        [/kill]

        [item]
            x=$malin_store.x
            y=$malin_store.y
            image=units/spirits/fire-death6.png
        [/item]

        {MSG_UNIT Galas ( _ "She's... she is...")}
#define MSG_MALIN_DUST TEXT
    [scroll_to]
        x=$malin_store.x
        y=$malin_store.y
    [/scroll_to]
    [message]
        speaker=narrator
        image=units/spirits/fire-death6.png
        caption= _ "Mal Keshar"
        message={TEXT} # wmllint: ignore
    [/message]
#enddef
        {MSG_MALIN_DUST ("`" + _"(pile of dust laying on the ground)
She's lovely.")}
        {MSG_UNIT Elynia ( _ "Gee, thanks, but you have not told me who you are yet.")}
        {MSG_UNIT Galas ( _ "I am Galas, leader of the elves who inhabited your valley, my Lady.")}
        {MSG_UNIT Althurin ( _ "Althurin, high Dwarvish Runemaster to the kingdom of Knalga.")}
        {MSG_UNIT Anlindë ( _ "Anlindë, first advisor of Galas, and this is...")}
        {MSG_MALIN_DUST (_"Mal Keshar, necromancer and sort of a burned pile of bones. Could you stop your chattering and restore me?")}
        {MSG_UNIT Elynia ( _ "How come? You should be gone now, foul abomination...")}
        {MSG_UNIT Anlindë ( _ "Actually, he has helped us along the way to find you, my lady, and saved our lives multiple times. You are the Lady of Light, right?")}
        {MSG_UNIT Elynia ( _ "That is what my people used to call me. And how can I trust your word, dreadful cultist?")}
        {MSG_UNIT Galas ( _ "What?")}
        {MSG_UNIT Elynia ( _ "I might have been aslept for all this time but my memory still serves, Galas, grand-son of Alduil. You have been to the side of our worst enemy all this time and you did not know. But well, we could set our differences aside and talk, why did you come here, to awake me?")}
        {MSG_UNIT Galas ( _ "After you parted ways with our people, and the now desert elves, we set home in a valley located in the far East, which we named in your honor, and lived there for long. However, recent events forced us to flee from there, and find a new home. That is where we met Keshar...")}
        {MSG_MALIN_DUST (_"Mal Keshar, please.")}
        {MSG_UNIT Galas ( _ "And he led us here to ask you for help in our war against the demons...")}
        {MSG_UNIT Elynia ( _ "The what? Demons!? But... but... that's impossible, I made sure they would never return, sealed Yanqui, and closed the portal! Nobody could have figured out how to open one again, I think.")}
        {MSG_UNIT Galas ( _ "Yanqui? I do not understand...")}
        {MSG_UNIT Elynia ( _ "That part of history was forbidden to tell of for centuries, but I guess in the current circumstances we could make an exception. I can feel... I can feel your suffering for what has happened.")}
        {MSG_MALIN_DUST (_"Me too, sort of.")}
        {MSG_UNIT Elynia ( _ "Your soul is corrupted, but you seek redemption, I feel it. I can make an exception with you too, Malin the Damned.")}
        {MSG_MALIN_DUST (_"The last person who called me that way had a sudden death, you know possibly better than me that.")}
        {MSG_UNIT Elynia ( _ "Oh, in such case perhaps you did not want me to restore your body...")}
        {MSG_MALIN_DUST (_"Oh, no, no! Do it, please, this position is very uncomfortable, at least for me.")}
        #undef MSG_MALIN_DUST
        {FLASH_GREEN ()}
        [unstore_unit]
            variable=malin_store
            find_vacant=yes
        [/unstore_unit]
        {FULL_HEAL (description=Mal Keshar)}
        [store_unit]
            variable=malin_store
            kill=yes
            [filter]
                description=Mal Keshar
            [/filter]
        [/store_unit]
        [unstore_unit]
            variable=malin_store
            find_vacant=yes
            {COLOR_HEAL}
            text=$malin_store.hitpoints
        [/unstore_unit]
        [removeitem]
            x=$malin_store.x
            y=$malin_store.y
        [/removeitem]
        {CLEAR_VARIABLE malin_store}
        {REDRAW}
        [sound]
            name=heal.wav
        [/sound]
        {MSG_UNIT (Mal Keshar) ( _ "Ahhh, much better!")}
        {MSG_UNIT Galas ( _ "My lady, so you know where did the demons we fought come from?")}
        {MSG_UNIT Elynia ( _ "I am not completely sure, but I think they come from the underworld, exactly where Yanqui came from. And you can call me Elynia, by the way. You have always confused me with being a goddess, but I am afraid I am as mortal and vulnerable as any of you.")}
        {MSG_UNIT Elynia ( _ "Now I am afraid too that the time to tell the story of the demon lord Yanqui has come. Anlindë might have told you little, vague references to it, but you need to know what you are facing. It is not as simple as it seems.")}
        {MSG_UNIT Anlindë ( _ "I am not sure it is adequate. You might not trust me, but I really do not want that to happen again.")}
        {MSG_UNIT Elynia ( _ "It is time. Now, you probably want to sit down on the grass. This will take quite a long time to tell.")}
        {MSG_UNIT Elynia ( _ "We should start with the old story of the Golden Age. The continent was dominated by Humans on the central lands, known as their Empire of Wesnoth back then. The Elves lived on the North-eastern, North-western and South-western forests, although small groups also wandered around Wesnoth. The Dwarves controlled all the mountains, hills and suchlike, usually competing with the fierce orcs and trolls who also liked that kind of terrains.")}
        {MSG_UNIT Elynia ( _ "The forests south of the Dwarven Kingdom of Knalga were known as the Wesmere forest. Peaceful lands north-west from the Empire of Wesnoth. The elves that lived there considered knowledge the most valuable thing in this world, so they were enthusiastic in investigating every secret of the world where we live. Every and each one, including the darkest ones...")}
        {MSG_UNIT Elynia ( _ "Nobody knows exactly how it happened, but they awoke some greater evil with their experiments, opening a portal to the underworld, just out of their curiosity and ambition of wisdom. That is when Yanqui appeared, in the form of a young elf. He told them that a great darkness was going to swallow the lands and destroy all the knowledge they had collected over the years, and said that he would protect them if they worshiped him as a god, giving them unlimited knowledge and power, just what they wanted. Ambition blinded their minds, and agreed, even though Yanqui demanded blood sacrifices as part of the deal. All those who disagreed ended their lives as the first sacrifices for the demon lord.")}
        {MSG_UNIT Elynia ( _ "But something else was happening in non-elven lands. The humans of Wesnoth, or more specifically, the King of Wesnoth, had created a second sun some time before all this, Naia, which you can see now every day, by gathering all capable magi and sending a mountain to the skies, to shine as a sun, only to destroy darkness and evilness forever. It was initially a success, although the darkness was not abolished completely. But the human's greed led them to send a third mountain to the skies, by the time Yanqui appeared. He must have had predicted that, and the Wesmere elves knew of what would happen, so he used the fact to trick them.")}
        {MSG_UNIT Elynia ( _ "The third sun, Gaia, was to be sent to the skies. But the magi had not worried about learning magic as much as they had before the creation of Naia, since the evilness that forced them to learn magic millenia ago, was seemingly gone. The king of Wesnoth decreed the creation of Gaia, nevertheless, not following my advice. Yes, I was there, and to my heart's pain, I witnessed all that happened that fateful day.")}
        {MSG_UNIT Elynia ( _ "It's ironical how we elves always despised humans because of their moral, intellectual and biological inferiority. The humans caused our doom, but a part of us made it worse.")}
        {MSG_UNIT (Mal Keshar) ( _ "But, what happened with the third sun?")}
        {MSG_UNIT Elynia ( _ "As I said, the human magi's mastery of magic arts was not as strong as it used to be, and their attempt to lift and send Gaia to the skies was a total disaster. Their powers were not capable of setting Gaia to remain high in the skies, and the mountain fell off, crashing down onto Weldyn, the kingdom's capital, causing volcanoes to erupt all over the planet, starting a mass earth-quake that destroyed cities, valleys, even mountains. All that was beautiful and worth was then ruined.")}
        {MSG_UNIT Elynia ( _ "The humans struggled to survive, but they killed the king, the magi, and their families for the chaos they had caused. A chaos that caused horrible wars amongst Elves, Dwarves, Orcs and Trolls, altogether. Naia and Sela, the remaining monuments to the human's empire, their greed, arrogancy and hubris, scorched all known lands, drying up rivers, fields, forests and lakes. But with the power given by Yanqui, Wesmere Forest stood intact, still peaceful and green. However, Yanqui declared all foreign elves heretics that did not deserve to live.")}
        {MSG_UNIT Elynia ( _ "So, as elves from other forests came to Wesmere as refugees, the dark cultists sacrificed them to Yanqui. The pain and agony was feeding him, growing his power stronger and greater, but when no more refugees came there, he ordered to organize raidings for capturing elves, humans, orcs, or whatever they could find in the outside lands. With the solar activity increasing, our forests were burned or dried out, and we had to abandon them. I had led my people out of the Northern forests, and we stumbled upon the Wesmere Forest.")}
        {MSG_UNIT Elynia ( _ "Obviously, not knowing what was happening in there, we decided to ask for refuge in Wesmere. However, at night during our travel to the capital, we were attacked. Many of us died, specially elders and children, who were sacrificed to Yanqui, as my husband, the Lord of Darkness, Argan, could find out, risking his own life. So we found ourselves in a difficult choice - stop our brethren, the Wesmere elves, and free them from the great evil, or go away and let more of our people, eventually us, be sacrificed by the cultists. Painfully, I chose the first, and started the War of Wesmere.")}
        {MSG_UNIT Elynia ( _ "Even though our number was superior, their religious frenzy, obsession and fear of destruction, almost led the Wesmere elves to victory. We fought with all our might, but that only called upon the fury of the demon lord, who appeared in his true form, to attack us from the skies. Argan and I had to call upon the power of the Union, risking destruction by our own powers, in order to defeat Yanqui. The Union of the Darkness and Light was not powerful enough, however, to destroy the demon, at least not entirely - its regeneration power was stronger.")}
        {MSG_UNIT Elynia ( _ "Finally we managed to tear apart his body, and seal all parts, and send them back to the underworld, destroying immediately the portal that was opened from Wesmere to the underworld.")}
        {MSG_UNIT Elynia ( _ "The victory had its price, however. The battlefield, Wesmere, was a wreck, and no life was left there, except for a few survivors, less than one hundred elves. The Wesmere elves surrended and begged for forgiveness, and told us the whole story. We let them live, except for the priests, which we had to execute and burn, until reducing their bodies to nothing but dust. We could not risk the possibility of them opening a portal again and summoning Yanqui a second time. Nor the possibility of future generations starting the same war once again, which would extermine us definitively in the new harsh world. So we also had to forbid telling the story, executing anyone who would dare to tell it.")}
        {MSG_UNIT Elynia ( _ "However, we were never sure whether we killed every cultist or not. One of them could escape execution, acting as innocent, as a simple ignorant follower, not cultist. I felt she had to be executed, but unfortunately the rest of my people did not agree. And you have her just by your side, Galas.")}
        {MSG_UNIT Galas ( _ "Anlindë? But... but, she...")}
        {MSG_UNIT Anlindë ( _ "I was a priestess to Yanqui, but not willing. I was forced by him, he would have killed my family otherwise. I regreted my decission when I saw him killing them from the skies, as I realized that worshiping him could not save my family from a horrible death.")}
        {MSG_UNIT Galas ( _ "But then, why the elves parted ways?")}
        {MSG_UNIT Elynia ( _ "Anlindë wanted them to return East. She said that we should have explored the unknown instead of retreating south. That, and Alduil's foolishness, made us all depart different ways. Argan and I decided that our people no longer needed us, for Alduil and Anlindë would not listen to us, and Tanuil with his small group went South, where I felt no longer capable of going to, after the fight against Yanqui, which weakened us. So Argan and I went here, to the depths, to live in peace. I am still surprised that Alduil and Anlindë could find a valley with life in the far East, perhaps I was wrong after all.")}
        {MSG_UNIT Elynia ( _ "However, one day, Argan disappeared. I could not feel his presence any longer, and I waited for years, and years, until I fell asleep, fell after the powers of Darkness which were evil for me without the Union with Argan. Meanwhile, most of my powers have diminished, because of lack of practice and use. I am not sure I can help you in this fight at all.")}
        {MSG_UNIT Elynia ( _ "But I will try anyway. I can't avoid, though, to be disturbed by the fact that one has opened a portal and possibly summoned back Yanqui. The person who did that, must have known this history in some way, or have done it by accident.")}
        {MSG_UNIT Althurin ( _ "Or be related in some way to Yechnagoth. She somehow also knew of Yanqui, or that was what we had been told by our hero, Rogrimir.")}
        {MSG_UNIT Elynia ( _ "Yechnagoth... the Eater of Souls?")}
        {MSG_UNIT Althurin ( _ "Yes. According to the history, the Quenoth desert elves, led by Kalehssar, nephew of Tanuil, defeated her in an isle far to the west, in middle of the unknown ocean. She could corrupt all souls from that place, including humans, orcs, nagas and saurians. After being defeated, though, that influence was gone. But some humans still had a leader, and they are the ones behind all this plot, I think. The 'loyalists'. They just want to expand their empire by taking over these lands and other to be discovered yet.")}
        {MSG_UNIT Elynia ( _ "Interesting, but how could a simple human control these forces? There must be something else, more powerful, behind this.")}
        {MSG_UNIT (Mal Keshar) ( _ "I think we should move and quit wasting time here. The world needs us. And we have got to find Argan.")}
        {MSG_UNIT Elynia ( _ "I do not think we shall find him. It is like... like if the earth itself swallowed him.")}
        {MSG_UNIT Galas ( _ "Fair enough, let us go, I cannot wait to get out of these tunnels.")}
        {MSG_UNIT Anlindë ( _ "Neither can I.")}
        [kill]
            animate=no
            description=Elynia
        [/kill]
        [unit]
            side=1
            canrecruit=no
            # Work-around 1.4 engine bug
            gender=female
            type=Lady of Light
            description=Elynia
            user_description= _ "Elynia"
            {IS_HERO}
            unrenamable=yes
            x,y=31,26
            {FACING_REVERSE}
            upkeep=loyal
            # Loyal, to herself :)
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_DEXTROUS}
            [/modifications]
        [/unit]

        {CLEAR_VARIABLE met_igor}
        {CLEAR_VARIABLE took_berserker}
        {CLEAR_VARIABLE took_drainer}
        {CLEAR_VARIABLE tsl_glyph_1}
        {CLEAR_VARIABLE tsl_glyph_2}
        {CLEAR_VARIABLE tsl_glyph_3}
        {CLEAR_VARIABLE tsl_glyph_4}
        {CLEAR_VARIABLE tsl_glyph_5}
        {CLEAR_VARIABLE tsl_glyph_6}
    [/event]

    [event]
        name=moveto
        [filter]
            x=1-20 ,13-20
            y=24-30,15-25
            side=1
        [/filter]
        {EX_REMOVE_SHROUD (
        {RECT 12 16 19 31}
        terrain="Ww,Wo"
        )}
        {REDRAW}
        {MSG_SPEAKER unit ( _ "Wow. This place is plenty of water, deep and shallow. Some small fords should allow us to get past it, but I see that they are well guarded by water spirits and other creatures which have some kind of afinity with water. This will not be too easy, yet not too hard.")}
    [/event]

    [event]
        name=moveto
        [filter]
            {RECT 38 34 50 40}
            [or]
                {RECT 40 45 54 50}
            [/or]
            [or]
                {RECT 50 40 55 46}
            [/or]
            [and]
                side=1
            [/and]
        [/filter]
        {REDRAW}
        {MSG_UNIT unit ( _ "There are lava streams down these chasms, from which hot air ascends and warms this cave. Interesting - there must be a volcano close to this cave system, or perhaps we are right into one.")}
    [/event]

    ################### DRAINING POTION ###################
    [item]
        x,y=2,4
        image=items/potion-poison.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            x,y=2,4
            side=1
        [/filter]
        [if]
            [and]
                [not]
                    [have_unit]
                        race=undead
                        x,y=$unit.x,$unit.y
                    [/have_unit]
                [/not]
                [not]
                    [have_unit]
                        race=bats
                        x,y=$unit.x,$unit.y
                    [/have_unit]
                [/not]
            [/and]
            [and]
                {VARIABLE_BOOLEAN_EQUALS took_drainer no}
            [/and]
            [then]
                [message]
                    speaker=unit
                    message= _ "This strange potion bottle gives me chills. A label with a skull on it makes it clear that it is a bad thing, but somehow, it does not smell like poison. A scroll close to it explains that it is a draining potion, which albeit makes the drinker much weaker, gives them the draining ability with their melee attacks. I am not sure if it is really worth the exchange, but draining my oponent's vital energy certainly attracts me."
                    [option]
                        message= _ "I think it is worthy, let me take it."
                        [command]
                            {VARIABLE took_drainer yes}
                            {MSG_NARRATOR ( _ "The unit drinks the potion, feeling immediately dazed and confused. Then, its vital energy is lowered, but its melee weapons gain the draining special.")}
                            [removeitem]
                                x,y=2,4
                            [/removeitem]
                            {PLAY_SOUND poison.ogg}
                            [object]
                                [filter]
                                    x,y=2,4
                                [/filter]
                                duration=forever
                                id=Drainer Potion
                                name= _ "Drainer Potion"
                                image=icons/potion-green-4.png
                                description= _ "This potion adds the Draining ability to this unit's melee attacks, and makes it quite stronger against arcane attacks."
                                [effect]
                                    apply_to=attack
                                    range=melee
                                    [set_specials]
                                        mode=append
                                        {WEAPON_SPECIAL_DRAIN}
                                    [/set_specials]
                                [/effect]
                                [effect]
                                    apply_to=hitpoints
                                    increase_total=-5%
                                [/effect]
                                [effect]
                                    apply_to=resistance
                                    replace=no
                                    [resistance]
                                        arcane=-10%
                                    [/resistance]
                                [/effect]
                            [/object]
                            {EX_LOYAL_UNIT (Giant Leech) () () 8 1 5}
                            {MSG_SPEAKER unit ( _ "Oh.")}
                        [/command]
                    [/option]
                    [option]
                        message= _ "On a second thought, I don't like the idea, it is abominable."
                    [/option]
                [/message]
            [/then]
            [else]
                [if]
                    {VARIABLE_BOOLEAN_EQUALS took_drainer no}
                    [then]
                        [message]
                            speaker=narrator
                            caption= _ "Drainer Potion"
                            image=icons/potion-green-4.png
                            message= _ "This potion would add the Draining ability to this unit's melee attacks, if only it was a living unit. You might want to move an living one to it instead."
                        [/message]
                    [/then]
                [/if]
            [/else]
        [/if]
    [/event]

    ################### BERSERK POTION ###################
    [item]
        x,y=21,10
        image=items/potion-red.png
    [/item]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            x,y=21,10
            side=1
        [/filter]

        [if]
            {VARIABLE_BOOLEAN_EQUALS took_berserker no}
            [then]
                [message]
                    speaker=unit
                    message= _ "What a beautiful flask of red potion! I open and smell it, and I immediately feel euphoric and energized. It must be one of those ancient 'berserk' potions, which make the drinker stronger and frenetically lethal for its enemies. This implies many risks in combat, as berserk attacks don't allow you to get protection or suchlike while in combat. However, it might prove to be useful in our war against the demons."
                    [option]
                        message= _ "I'll take it, I do not fear death!"
                        [command]
                            {VARIABLE took_berserker yes}
                            [removeitem]
                                x,y=21,10
                            [/removeitem]
                            [object]
                                [filter]
                                    x,y=21,10
                                [/filter]
                                duration=forever
                                id=Berserk Potion
                                name= _ "Berserk Potion"
                                image=icons/potion-red-1.png
                                description= _ "This potion adds the Berserk ability to this unit's melee attacks (which also gain strength), and makes it stronger against impact, blade and fire attacks. Also, increases its maximum hitpoints 10% of the current maximum."
                                [effect]
                                    apply_to=attack
                                    range=melee
                                    set_description={STR_BERSERK_ATTACK_NAME}
                                    increase_damage=1
                                    [set_specials]
                                        mode=append
                                        {WEAPON_SPECIAL_BERSERK}
                                    [/set_specials]
                                [/effect]
                                [effect]
                                    apply_to=hitpoints
                                    increase_total=10%
                                    heal_full=yes
                                [/effect]
                                [effect]
                                    apply_to=resistance
                                    replace=no
                                    [resistance]
                                        impact=-30%
                                        blade=-10%
                                        fire=-20%
                                    [/resistance]
                                [/effect]
                            [/object]
                            {MSG_SPEAKER unit ( _ "Great! I now feel invincible!")}
                            {EX_LOYAL_UNIT (Imp) () () 2 19 11}
                            {EX_LOYAL_UNIT (Chaos Hound) () () 2 19 8}
                            {EX_LOYAL_UNIT (Demon) () () 2 22 8}
                            {MAKE_FACING_REVERSE}
                            [message]
                                x,y=22,8
                                message= _ "Oh really? Let me check if you are really invincible!"
                            [/message]
                            {MSG_SPEAKER unit ( _ "Uh-oh. I might be in trouble. Or perhaps not.")}
                        [/command]
                    [/option]
                    [option]
                        # FIXME: this text might be too much like a biased opinion of mine on berserkers!
                        message= _ "On the other hand, I do not want to get myself vanquished so easily."
                    [/option]
                [/message]
            [/then]
            [else]
                [if]
                    [variable]
                        name=took_berserker
                        equals=no
                    [/variable]
                    [then]
                        [message]
                            speaker=narrator
                            caption= _ "Berserk Potion"
                            image=icons/potion-red-1.png
                            message= _ "This potion would add the Berserk ability to this unit's melee attacks, if only it was a strong, fearsome real fighter unit, living or not living."
                        [/message]
                    [/then]
                [/if]
            [/else]
        [/if]
    [/event]

    ################### TOUCH-PLATE 35,50 ###################
    {ITEM_TOUCHPLATE 35 50}
    [event]
        name=moveto
        [filter]
            side=1
            x,y=35,50
        [/filter]

        [removeitem]
            x,y=35,50
        [/removeitem]

        [terrain]
            x,y=24,41
            terrain=Ryd
        [/terrain]

        {MSG_NARRATOR _"Touchplate triggered. A magical gate opens."}

        [remove_shroud]
            {RECT 20 37 29 43}
            side=1
        [/remove_shroud]
        {REDRAW}
        {SCROLL_TO 24 41}
        {DELAY 750}
        {SCROLL_TO $x1 $y1}
    [/event]

    ################### IGOR'S HOME ###################
    {PLACE_IMAGE scenery/signpost.png 3 18}
    {PLACE_IMAGE items/burial.png 7 18}
    {PLACE_IMAGE items/burial.png 5 20}
    {PLACE_IMAGE items/orcish-flag.png 7 20}
    {PLACE_IMAGE items/burial.png 1 15}
    {PLACE_IMAGE scenery/underground_temple.png 8 19}
    [event]
        name=moveto
        [filter]
            side=1
            x,y=3,18
        [/filter]
        {ALLOW_UNDO}
        {REDRAW}
        [message]
            speaker=narrator
            image="scenery/signpost.png"
            message= _ "Go'way!! We're like, closed or somethin'!!!"
        [/message]
        [message]
            speaker=unit
            message= _ "Um... okay."
        [/message]
    [/event]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x,y=8,19
        [/filter]
        [if]
            {VARIABLE_BOOLEAN_EQUALS met_igor no}
            [then]
                [message]
                    speaker=unit
                    message= _ "It is strange to find a house here, in the deep, but looks like someone inhabits it, for the good maintenance of the walls and door. The decoration of this cave also appears to be recent. What should I do, get away or see if somebody is living there?"
                    [option]
                        message= _ "Shout and see."
                        [command]
                            {MSG_SPEAKER unit ( _ "Hellooooo! Anybody at home?")}
                            {MSG_NARRATOR ( _ "(silence)")}
                            {MSG_SPEAKER unit ( _ "I said HELLO!!!")}
                            {MSG_NARRATOR ( _ "(yet more silence)")}
                            [message]
                                speaker=unit
                                message= _ "Should I insist another time, or abandon the cave?"
                                [option]
                                    message= _ "Insist again."
                                    [command]
                                        {MSG_SPEAKER unit ( _ "Very well, let me break in...")}
                                        {MSG_NARRATOR ( _ "BOOM!!! CRASH!!! CRACK! CLANG! CRASH!!! BAM!!")}
                                        {MSG_SPEAKER unit ( _ "So, anybody at home now?")}
                                        [unit]
                                            description=Igor
                                            user_description= _ "Igor"
                                            side=1
                                            type=Wolf Rider
                                            profile="portraits/igor.png"
                                            unrenamable=yes
                                            moves=5
                                            resting=no
                                            upkeep=loyal
                                            x,y=8,19
                                            [modifications]
                                                {TRAIT_LOYAL}
                                                {TRAIT_STRONG}
                                            [/modifications]
                                        [/unit]
                                        {VARIABLE met_igor "yes"}
                                        {MSG_UNIT Igor ( _ "Aww. Is it that I can't find a safe place'ta live in?")}
                                        {MSG_SPEAKER unit ( _ "A goblin? How did you get here?")}
                                        {MSG_UNIT Igor ( _ "It's a long story. I used to live in the northlands, in a small town with my fellows. However, it came'ta happen that the foul 'loyalists' invaded it, ransacked it, killed my people, and left me with no home'ta live in. I couldn't believe I survived that night, and I just wish they had the same luck. Fearing for my life, I decided to enter the caves, and go the deepest possible, looking for safety and peace.")}
                                        {MSG_UNIT Igor ( _ "So I found these caverns, and set home here. However, da humans appeared again with their filthy cronies, and I managed to hide my cave from them. Now that you unhid it, I'll surely perish.")}
                                        {MSG_SPEAKER unit ( _ "I see. But perhaps you would prefer to follow us, instead of staying in these perilous pits, victim to the loyalists. We can give you protection.")}
                                        {MSG_UNIT Igor ( _ "Oh really? Wait, let me prepare my baggage and I shall go with you.")}
                                        {MSG_SPEAKER unit ( _ "Very well.")}
                                    [/command]
                                [/option]
                                [option]
                                    message= _ "Abandon."
                                [/option]
                            [/message]
                        [/command]
                    [/option]
                    [option]
                        message= _ "I think it would be safer to remain away from this cave."
                    [/option]
                [/message]
            [/then]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no
        {ALLOW_UNDO}
        [filter]
            side=1,2
        [/filter]
        {VARIABLE_OP rumble_test random 1..35}
        [if]
            [variable]
                name=rumble_test
                numerical_equals=1
            [/variable]
            [then]
                {TREMOR}
            [/then]
        [/if]
        {CLEAR_VARIABLE rumble_test}
    [/event]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            [filter_location]
                [filter_adjacent_location]
                    terrain=Xg^* # wmllint: ignore
                [/filter_adjacent_location]
            [/filter_location]
        [/filter]
        {MSG_SPEAKER unit ( _ "Um... these gates seem to be magical in nature. They gently blow in a blueish tone, and I cannot even touch them.")}
        {MSG_UNIT (Galas) ( _ "There must be a way to open them, somewhere.")}
    [/event]
[/scenario]
